From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Jan Tojnar <jtojnar@gmail.com>
Date: Fri, 1 Oct 2021 23:11:26 +0200
Subject: [PATCH] docs: Fix build with WebkitGTK 4.1

---
 docs/reference/devhelp.toml.in | 2 +-
 docs/reference/meson.build     | 1 +
 meson.build                    | 2 ++
 3 files changed, 4 insertions(+), 1 deletion(-)

diff --git a/docs/reference/devhelp.toml.in b/docs/reference/devhelp.toml.in
index 14d375036a1a..088bf1f54900 100644
--- a/docs/reference/devhelp.toml.in
+++ b/docs/reference/devhelp.toml.in
@@ -16,7 +16,7 @@ dependencies = ["Gtk-3.0",]
   description = "The GTK toolkit"
   docs_url = "https://developer.gnome.org/gtk3/stable/"
 
-  [dependencies."WebKit2-4.0"]
+  [dependencies."WebKit2-@webkit_abi@"]
   name = "WebKitGTK 2"
   description = "WebKit rendering widget for GTK"
   docs_url = "https://webkitgtk.org/reference/webkit2gtk/stable/"
diff --git a/docs/reference/meson.build b/docs/reference/meson.build
index d689e234ba25..5566218a3c13 100644
--- a/docs/reference/meson.build
+++ b/docs/reference/meson.build
@@ -14,6 +14,7 @@ gidocgen = find_program('gi-docgen', required: get_option('gtk_doc'))
 if get_option('gtk_doc')
   toml_data = configuration_data()
   toml_data.set('version', meson.project_version())
+  toml_data.set('webkit_abi', webkit_abi)
 
   devhelp_toml = configure_file(
     input: 'devhelp.toml.in',
diff --git a/meson.build b/meson.build
index e57e466e963f..1570d68d3756 100644
--- a/meson.build
+++ b/meson.build
@@ -47,7 +47,9 @@ lt_age = 0
 LIBDEVHELP_LT_VERSION = '@0@.@1@.@2@'.format(lt_current, lt_revision, lt_age)
 
 webkit_dep = dependency('webkit2gtk-4.1', required : false)
+webkit_abi = '4.1'
 if not webkit_dep.found()
+  webkit_abi = '4.0'
   webkit_dep = dependency('webkit2gtk-4.0')
 endif
 
