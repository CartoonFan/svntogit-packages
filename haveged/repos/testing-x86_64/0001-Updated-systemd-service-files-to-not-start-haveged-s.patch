From cef1d425b5431847b8c9ab5b00c3e6b82a32b4f2 Mon Sep 17 00:00:00 2001
From: Jirka Hladky <jhladky@redhat.com>
Date: Mon, 30 Aug 2021 01:37:59 +0200
Subject: [PATCH 1/1] Updated systemd service files to not start haveged
 service on kernel 5.6 and newer
---
 contrib/Fedora/haveged-switch-root.service | 1 +
 contrib/Fedora/haveged.service             | 1 +
 contrib/SUSE/haveged-switch-root.service   | 1 +
 3 files changed, 3 insertions(+)

diff --git a/contrib/Fedora/haveged-switch-root.service b/contrib/Fedora/haveged-switch-root.service
index 8cc38cf..a3eb086 100644
--- a/contrib/Fedora/haveged-switch-root.service
+++ b/contrib/Fedora/haveged-switch-root.service
@@ -1,6 +1,7 @@
 [Unit]
 Description=Tell haveged about new root
 DefaultDependencies=no
+ConditionKernelVersion=<5.6
 ConditionPathExists=/etc/initrd-release
 Before=initrd-switch-root.service
 JoinsNamespaceOf=haveged.service
diff --git a/contrib/Fedora/haveged.service b/contrib/Fedora/haveged.service
index abb9cfc..2bbb9a3 100644
--- a/contrib/Fedora/haveged.service
+++ b/contrib/Fedora/haveged.service
@@ -2,6 +2,7 @@
 Description=Entropy Daemon based on the HAVEGE algorithm
 Documentation=man:haveged(8) http://www.issihosts.com/haveged/
 DefaultDependencies=no
+ConditionKernelVersion=<5.6
 After=systemd-tmpfiles-setup-dev.service
 Before=sysinit.target shutdown.target systemd-journald.service
 
diff --git a/contrib/SUSE/haveged-switch-root.service b/contrib/SUSE/haveged-switch-root.service
index 9757da4..24b8649 100644
--- a/contrib/SUSE/haveged-switch-root.service
+++ b/contrib/SUSE/haveged-switch-root.service
@@ -1,6 +1,7 @@
 [Unit]
 Description=Tell haveged about new root
 DefaultDependencies=no
+ConditionKernelVersion=<5.6
 ConditionPathExists=/etc/initrd-release
 Before=initrd-switch-root.service
 JoinsNamespaceOf=haveged.service
